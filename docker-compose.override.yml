# Override to fix port conflicts and mount source code for development
# This file changes the PostgreSQL port from 5432 to 5433
# to avoid conflicts with local PostgreSQL installation
# and mounts local source code for live editing

services:
  cvat_db:
    ports:
      - '127.0.0.1:5433:5432'  # Changed from 5432 to 5433

  cvat_server:
    labels:
      traefik.http.routers.cvat.rule: (Host(`localhost`) || Host(`127.0.0.1`)) && (PathPrefix(`/api/`) || PathPrefix(`/static/`) || PathPrefix(`/admin`) || PathPrefix(`/django-rq`))
    volumes:
      - ./cvat:/home/django/cvat

  cvat_ui:
    build:
      context: .
      dockerfile: Dockerfile.ui
    pull_policy: build
    labels:
      traefik.http.routers.cvat-ui.rule: Host(`localhost`) || Host(`127.0.0.1`)

  cvat_worker_annotation:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_chunks:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_quality_reports:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_import:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_export:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_webhooks:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_consensus:
    volumes:
      - ./cvat:/home/django/cvat

  cvat_worker_utils:
    volumes:
      - ./cvat:/home/django/cvat
